
<script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>

<style type="text/css">
	h3 a{
		color: #4b0082;
		text-decoration: none;
		background: #F0F8FF;
	}
	.items{
		margin: 10px;
		font-size: 20px;
	}
	.items button{
		margin-left: 5px;
	}
	.f-con{
		display: flex;
	}
</style>

<h3>
	<a href="{% url 'logout' %}">Logout, {{ request.user.username }}</a>	
</h3>

<div class="f-con">
	<form id="tform" method="POST">
		{% csrf_token %}
		Add Task {{form.as_p}}
        <input type="submit" id="tsubmit" value="+ add">
	</form>
</div>

<div class="items">
	{% for task in tasks %}
		<button id="{{task.id}}" class="delete-b">Delete ‚ùå</button>
		{% if task.is_completed != True %}
			<button id="{{task.id}}" class="is_comp">Complete ‚úî</button> 
		{% else %}
			<button id="{{task.id}}" class="is_comp">Completed ‚úî</button> 
		{% endif %}
		üëâüèª {{task.id}}, {{task.text}}
		<br>
	{% endfor %}
</div>

<script type="text/javascript">

	// ADD TASK
	$(document).on('submit', '#tform', function(event){
		event.preventDefault();

		console.log("llllll");
	    
	    var formData = new FormData(this)

    	$.ajax({
            url : "add-task/",
            type : 'POST',
            data : formData,
            processData: false,
            contentType: false,
            success : function(data){
			    console.log(data)
			    $('#task_text').val("");
			    $('.items').prepend($("<button>Delete ‚ùå</button> <button>Complete ‚úî</button> üëâüèª "+ data.task + "<br>"))
	        }
        });

	});

	// COMPLETE TASK
	$(document).on('click', '.is_comp', function(){
		task_id = $(this).attr("id")
	    console.log(task_id)
	    console.log(typeof task_id)

        $.ajax({
	        url : "comp-task/"+task_id,
	        type : "PUT",
	        processData: false,
        	contentType: false,
	        success : function(data){
			    console.log('data')
			    console.log(data)
	        }
    	})

	});

	// DELETE TASK
	$(document).on('click', '.delete-b', function(){
		task_id = $(this).attr("id")
	    console.log(task_id)
	    console.log(typeof task_id)

        $.ajax({
	        url : "/delete-task/"+task_id,
	        type : "DELETE",
	        processData: false,
        	contentType: false,
	        success : function(data){
			    console.log('data')
			    console.log(data)
	        }
    	})

	});
</script>